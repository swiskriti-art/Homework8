[
  {
    "objectID": "HW8.html",
    "href": "HW8.html",
    "title": "HW8",
    "section": "",
    "text": "library (tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.2\n✔ ggplot2   4.0.0     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.1.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(tidymodels)\n\nWarning: package 'tidymodels' was built under R version 4.5.2\n\n\n── Attaching packages ────────────────────────────────────── tidymodels 1.4.1 ──\n✔ broom        1.0.10     ✔ rsample      1.3.1 \n✔ dials        1.4.2      ✔ tailor       0.1.0 \n✔ infer        1.0.9      ✔ tune         2.0.1 \n✔ modeldata    1.5.1      ✔ workflows    1.3.0 \n✔ parsnip      1.3.3      ✔ workflowsets 1.1.1 \n✔ recipes      1.3.1      ✔ yardstick    1.3.2 \n\n\nWarning: package 'dials' was built under R version 4.5.2\n\n\nWarning: package 'infer' was built under R version 4.5.2\n\n\nWarning: package 'modeldata' was built under R version 4.5.2\n\n\nWarning: package 'parsnip' was built under R version 4.5.2\n\n\nWarning: package 'recipes' was built under R version 4.5.2\n\n\nWarning: package 'rsample' was built under R version 4.5.2\n\n\nWarning: package 'tailor' was built under R version 4.5.2\n\n\nWarning: package 'tune' was built under R version 4.5.2\n\n\nWarning: package 'workflows' was built under R version 4.5.2\n\n\nWarning: package 'workflowsets' was built under R version 4.5.2\n\n\nWarning: package 'yardstick' was built under R version 4.5.2\n\n\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n\nlibrary (ggcharts)\n\nReading CSV file\n\nbike_rentals &lt;- read_csv(\"https://www4.stat.ncsu.edu/~online/datasets/SeoulBikeData.csv\", \n                              locale = locale(encoding = \"latin1\"),\n                         name_repair = function(nm) str_to_lower(str_replace_all(str_replace_all(nm, \" \", \"_\"), \"[()/°%]\", \"\")))\n\nRows: 8760 Columns: 14\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (4): date, seasons, holiday, functioning_day\ndbl (10): rented_bike_count, hour, temperaturec, humidity, wind_speed_ms, vi...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nbike_rentals\n\n# A tibble: 8,760 × 14\n   date       rented_bike_count  hour temperaturec humidity wind_speed_ms\n   &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;\n 1 01/12/2017               254     0         -5.2       37           2.2\n 2 01/12/2017               204     1         -5.5       38           0.8\n 3 01/12/2017               173     2         -6         39           1  \n 4 01/12/2017               107     3         -6.2       40           0.9\n 5 01/12/2017                78     4         -6         36           2.3\n 6 01/12/2017               100     5         -6.4       37           1.5\n 7 01/12/2017               181     6         -6.6       35           1.3\n 8 01/12/2017               460     7         -7.4       38           0.9\n 9 01/12/2017               930     8         -7.6       37           1.1\n10 01/12/2017               490     9         -6.5       27           0.5\n# ℹ 8,750 more rows\n# ℹ 8 more variables: visibility_10m &lt;dbl&gt;, dew_point_temperaturec &lt;dbl&gt;,\n#   solar_radiation_mjm2 &lt;dbl&gt;, rainfallmm &lt;dbl&gt;, snowfall_cm &lt;dbl&gt;,\n#   seasons &lt;chr&gt;, holiday &lt;chr&gt;, functioning_day &lt;chr&gt;\n\n\n\nbike_rentals &lt;- bike_rentals |&gt;\n  rename(\"temp\" = \"temperaturec\",\n         \"wind_speed\" = \"wind_speed_ms\",\n         \"visibility\" = `visibility_10m`,\n         \"dew_point_temp\" = \"dew_point_temperaturec\",\n         \"rainfall\" = \"rainfallmm\",\n         \"solar_radiation\" = \"solar_radiation_mjm2\",\n         \"snowfall\" = \"snowfall_cm\")\n\n\npsych::describe(bike_rentals)\n\n                  vars    n    mean     sd  median trimmed    mad   min     max\ndate*                1 8760  183.00 105.37  183.00  183.00 134.92   1.0  365.00\nrented_bike_count    2 8760  704.60 645.00  504.50  612.58 553.75   0.0 3556.00\nhour                 3 8760   11.50   6.92   11.50   11.50   8.90   0.0   23.00\ntemp                 4 8760   12.88  11.94   13.70   13.19  13.94 -17.8   39.40\nhumidity             5 8760   58.23  20.36   57.00   58.02  23.72   0.0   98.00\nwind_speed           6 8760    1.72   1.04    1.50    1.63   1.04   0.0    7.40\nvisibility           7 8760 1436.83 608.30 1698.00 1509.50 447.75  27.0 2000.00\ndew_point_temp       8 8760    4.07  13.06    5.10    4.76  14.38 -30.6   27.20\nsolar_radiation      9 8760    0.57   0.87    0.01    0.38   0.01   0.0    3.52\nrainfall            10 8760    0.15   1.13    0.00    0.00   0.00   0.0   35.00\nsnowfall            11 8760    0.08   0.44    0.00    0.00   0.00   0.0    8.80\nseasons*            12 8760    2.50   1.11    2.00    2.49   1.48   1.0    4.00\nholiday*            13 8760    1.95   0.22    2.00    2.00   0.00   1.0    2.00\nfunctioning_day*    14 8760    1.97   0.18    2.00    2.00   0.00   1.0    2.00\n                    range  skew kurtosis   se\ndate*              364.00  0.00    -1.20 1.13\nrented_bike_count 3556.00  1.15     0.85 6.89\nhour                23.00  0.00    -1.20 0.07\ntemp                57.20 -0.20    -0.84 0.13\nhumidity            98.00  0.06    -0.80 0.22\nwind_speed           7.40  0.89     0.73 0.01\nvisibility        1973.00 -0.70    -0.96 6.50\ndew_point_temp      57.80 -0.37    -0.76 0.14\nsolar_radiation      3.52  1.50     1.12 0.01\nrainfall            35.00 14.53   284.76 0.01\nsnowfall             8.80  8.44    93.73 0.00\nseasons*             3.00  0.00    -1.35 0.01\nholiday*             1.00 -4.16    15.33 0.00\nfunctioning_day*     1.00 -5.17    24.72 0.00\n\n\nFrom the above psych::describe, there are no missing data in any of the columns\ntotal missing values in each column\n\nsapply (bike_rentals, function (x)sum (is.na(x)))\n\n             date rented_bike_count              hour              temp \n                0                 0                 0                 0 \n         humidity        wind_speed        visibility    dew_point_temp \n                0                 0                 0                 0 \n  solar_radiation          rainfall          snowfall           seasons \n                0                 0                 0                 0 \n          holiday   functioning_day \n                0                 0 \n\n\nChecking unique values for the categorical variables\n\nunique(bike_rentals$seasons)\n\n[1] \"Winter\" \"Spring\" \"Summer\" \"Autumn\"\n\nunique(bike_rentals$holiday)\n\n[1] \"No Holiday\" \"Holiday\"   \n\nunique(bike_rentals$functioning_day)\n\n[1] \"Yes\" \"No\" \n\n\n\nbike_rentals &lt;- bike_rentals |&gt;\n  mutate(date = dmy(date),\n         seasons = as.factor(seasons),\n         holiday = as.factor(holiday),\n         functioning_day = as.factor(functioning_day)\n        )\nbike_rentals\n\n# A tibble: 8,760 × 14\n   date       rented_bike_count  hour  temp humidity wind_speed visibility\n   &lt;date&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 2017-12-01               254     0  -5.2       37        2.2       2000\n 2 2017-12-01               204     1  -5.5       38        0.8       2000\n 3 2017-12-01               173     2  -6         39        1         2000\n 4 2017-12-01               107     3  -6.2       40        0.9       2000\n 5 2017-12-01                78     4  -6         36        2.3       2000\n 6 2017-12-01               100     5  -6.4       37        1.5       2000\n 7 2017-12-01               181     6  -6.6       35        1.3       2000\n 8 2017-12-01               460     7  -7.4       38        0.9       2000\n 9 2017-12-01               930     8  -7.6       37        1.1       2000\n10 2017-12-01               490     9  -6.5       27        0.5       1928\n# ℹ 8,750 more rows\n# ℹ 7 more variables: dew_point_temp &lt;dbl&gt;, solar_radiation &lt;dbl&gt;,\n#   rainfall &lt;dbl&gt;, snowfall &lt;dbl&gt;, seasons &lt;fct&gt;, holiday &lt;fct&gt;,\n#   functioning_day &lt;fct&gt;\n\n\nSubsetting on functioning_day = Yes as summary on the rented bike count is all 0\n\nbike_rentals |&gt;\n  filter(functioning_day == \"No\") |&gt;\n  group_by(date, seasons, holiday, functioning_day) |&gt;\n  summarize(across(rented_bike_count, \n                   list(\"mean\" = mean, \"median\" = median, \"sd\" = sd ),\n                   .names = \"{.fn}_{.col}\"))\n\n`summarise()` has grouped output by 'date', 'seasons', 'holiday'. You can\noverride using the `.groups` argument.\n\n\n# A tibble: 13 × 7\n# Groups:   date, seasons, holiday [13]\n   date       seasons holiday    functioning_day mean_rented_bike_count\n   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;      &lt;fct&gt;                            &lt;dbl&gt;\n 1 2018-04-11 Spring  No Holiday No                                   0\n 2 2018-05-10 Spring  No Holiday No                                   0\n 3 2018-09-18 Autumn  No Holiday No                                   0\n 4 2018-09-19 Autumn  No Holiday No                                   0\n 5 2018-09-28 Autumn  No Holiday No                                   0\n 6 2018-09-30 Autumn  No Holiday No                                   0\n 7 2018-10-02 Autumn  No Holiday No                                   0\n 8 2018-10-04 Autumn  No Holiday No                                   0\n 9 2018-10-06 Autumn  No Holiday No                                   0\n10 2018-10-09 Autumn  Holiday    No                                   0\n11 2018-11-03 Autumn  No Holiday No                                   0\n12 2018-11-06 Autumn  No Holiday No                                   0\n13 2018-11-09 Autumn  No Holiday No                                   0\n# ℹ 2 more variables: median_rented_bike_count &lt;dbl&gt;,\n#   sd_rented_bike_count &lt;dbl&gt;\n\n\nCalculating sum across rented_bike_count, rainfall and snowfall variables and mean across the weather variables for final model data sets\n\nbike_model_data &lt;- bike_rentals |&gt;\n  filter(functioning_day == \"Yes\") |&gt;\n  group_by(date, seasons, holiday) |&gt;\n  summarize(across(c(rented_bike_count, rainfall, snowfall, temp, humidity, wind_speed, visibility,\n                     dew_point_temp, solar_radiation),\n                   .fns = list(\"total\" = sum, \"mean\" = mean),\n                   .names = \"{.fn}_{.col}\")) |&gt;\n  select(date, seasons, holiday, total_rented_bike_count, total_rainfall, total_snowfall, mean_temp, mean_humidity, mean_wind_speed,\n         mean_visibility, mean_dew_point_temp, mean_solar_radiation)\n\n`summarise()` has grouped output by 'date', 'seasons'. You can override using\nthe `.groups` argument.\n\nbike_model_data\n\n# A tibble: 353 × 12\n# Groups:   date, seasons [353]\n   date       seasons holiday    total_rented_bike_count total_rainfall\n   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                        &lt;dbl&gt;          &lt;dbl&gt;\n 1 2017-12-01 Winter  No Holiday                    9539            0  \n 2 2017-12-02 Winter  No Holiday                    8523            0  \n 3 2017-12-03 Winter  No Holiday                    7222            4  \n 4 2017-12-04 Winter  No Holiday                    8729            0.1\n 5 2017-12-05 Winter  No Holiday                    8307            0  \n 6 2017-12-06 Winter  No Holiday                    6669            1.3\n 7 2017-12-07 Winter  No Holiday                    8549            0  \n 8 2017-12-08 Winter  No Holiday                    8032            0  \n 9 2017-12-09 Winter  No Holiday                    7233            0  \n10 2017-12-10 Winter  No Holiday                    3453            4.1\n# ℹ 343 more rows\n# ℹ 7 more variables: total_snowfall &lt;dbl&gt;, mean_temp &lt;dbl&gt;,\n#   mean_humidity &lt;dbl&gt;, mean_wind_speed &lt;dbl&gt;, mean_visibility &lt;dbl&gt;,\n#   mean_dew_point_temp &lt;dbl&gt;, mean_solar_radiation &lt;dbl&gt;\n\n\n##Summary plots\nCreating box plots for total bike rental with categorical variables\n\nggplot(data = bike_model_data,\n      aes(x = seasons, y = total_rented_bike_count, fill = seasons)) + \n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.4)\n\n\n\n\n\n\n\n\nFrom the above box plot , we can say that season direct influence on the bike rental count with winter being the slow season and summer being the high season.\n\nggplot(data = bike_model_data,\n      aes(x = holiday, y = total_rented_bike_count, fill = holiday)) + \n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.4)\n\n\n\n\n\n\n\n\nThe above box plot shows that there are less outliers for bike rented during non holidays than holidays.\nCreating scatter plots for numerical variables\n\nggplot(data = bike_model_data,\n      aes(x = total_rainfall, y = total_rented_bike_count, color = holiday)) +\n  geom_point() + geom_smooth(method = lm)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nThe above scatter plot shows that there is high correlation between rainfall amount and bike rented count. Also the rental count is affected by holiday as well.\n\nggplot(data = bike_model_data,\n      aes(x = total_rainfall, y = total_rented_bike_count, color = seasons)) +\n  geom_point() + geom_smooth(method = lm)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nFrom the above line graph, apart of from rainfall, there is some correlation between the bike rental count and seasons as well.\n\nggplot(data = bike_model_data,\n      aes(x = mean_temp, y = total_rented_bike_count, color = holiday)) +\n  geom_point() + geom_smooth(method = lm)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nFrom the above graph, when the temp increases the bike rental count also increases, with temperature in the range 2o to 25 being more favorable. Also from the line fit on holiday shows that holiday has some effect in the total bike rent count.\n\nggplot(data = bike_model_data,\n      aes(x = mean_temp, y = total_rented_bike_count, color = seasons)) +\n  geom_point() + geom_smooth(method = lm)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nFrom the above graph, when the temp increases the bike rental count also increases, with temperature in the range 2o to 25 being more favorable. Apart from temperature, the season also affect the total bike rental count. As shown in graph in summer bike rental count increases than in winter.\n##Data modeling\nCreating the model data with training and testing set\n\nbike_model_log &lt;- bike_model_data |&gt;\n  mutate(log_bike_rentals = log(total_rented_bike_count)) |&gt;\n  select(-total_rented_bike_count)\n\nbike_rentals_split &lt;- initial_split(bike_model_log, prop = 0.75, strata = seasons)\nbike_rentals_train &lt;- training(bike_rentals_split)\nbike_rentals_test &lt;- testing(bike_rentals_split)\n\n10 fold CV of the training data\n\nbike_rentals_cv &lt;- vfold_cv(bike_rentals_train, 10)\n\nCreating different recipes\n\nrecipe1 &lt;- recipe(log_bike_rentals ~ ., data = bike_rentals_train) |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(day_type = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"), \"Weekend\", \"Weekday\"))) |&gt;\n  step_rm(date) |&gt;\n  step_rm(starts_with(\"date_dow\")) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, day_type) \n\nrecipe1 |&gt;\n  prep(training = bike_rentals_train) |&gt;\n  bake(bike_rentals_train)\n\n# A tibble: 263 × 14\n   total_rainfall total_snowfall mean_temp mean_humidity mean_wind_speed\n            &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;\n 1         -0.299         -0.211     1.08         0.203          -0.866 \n 2          2.86          -0.211     0.918        1.65           -1.12  \n 3         -0.299         -0.211     0.938        0.243           1.35  \n 4         -0.162         -0.211     0.795       -0.0939          1.31  \n 5         -0.299         -0.211     0.755       -0.656          -0.0810\n 6         -0.299         -0.211     0.778       -0.602          -0.823 \n 7         -0.299         -0.211     0.862       -0.559          -0.259 \n 8         -0.299         -0.211     0.744       -0.705          -0.409 \n 9         -0.299         -0.211     0.826       -0.434          -0.673 \n10         -0.253         -0.211     0.906        0.614          -0.702 \n# ℹ 253 more rows\n# ℹ 9 more variables: mean_visibility &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,\n#   mean_solar_radiation &lt;dbl&gt;, log_bike_rentals &lt;dbl&gt;, seasons_Spring &lt;dbl&gt;,\n#   seasons_Summer &lt;dbl&gt;, seasons_Winter &lt;dbl&gt;, holiday_No.Holiday &lt;dbl&gt;,\n#   day_type_Weekend &lt;dbl&gt;\n\nrecipe2 &lt;- recipe(log_bike_rentals ~ ., data = bike_rentals_train) |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(day_type = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"), \"Weekend\", \"Weekday\"))) |&gt;\n  step_rm(date) |&gt;\n  step_rm(starts_with(\"date_dow\")) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, day_type) |&gt;\n  step_interact(terms = ~starts_with(\"holiday\")*starts_with(\"seasons\") ) |&gt;\n  step_interact(terms = ~mean_temp*starts_with(\"seasons\")) |&gt;\n  step_interact(terms = ~mean_temp*total_rainfall)\n\nrecipe2 |&gt;\n  prep(training = bike_rentals_train) |&gt;\n  bake(bike_rentals_train)\n\n# A tibble: 263 × 21\n   total_rainfall total_snowfall mean_temp mean_humidity mean_wind_speed\n            &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;\n 1         -0.299         -0.211     1.08         0.203          -0.866 \n 2          2.86          -0.211     0.918        1.65           -1.12  \n 3         -0.299         -0.211     0.938        0.243           1.35  \n 4         -0.162         -0.211     0.795       -0.0939          1.31  \n 5         -0.299         -0.211     0.755       -0.656          -0.0810\n 6         -0.299         -0.211     0.778       -0.602          -0.823 \n 7         -0.299         -0.211     0.862       -0.559          -0.259 \n 8         -0.299         -0.211     0.744       -0.705          -0.409 \n 9         -0.299         -0.211     0.826       -0.434          -0.673 \n10         -0.253         -0.211     0.906        0.614          -0.702 \n# ℹ 253 more rows\n# ℹ 16 more variables: mean_visibility &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,\n#   mean_solar_radiation &lt;dbl&gt;, log_bike_rentals &lt;dbl&gt;, seasons_Spring &lt;dbl&gt;,\n#   seasons_Summer &lt;dbl&gt;, seasons_Winter &lt;dbl&gt;, holiday_No.Holiday &lt;dbl&gt;,\n#   day_type_Weekend &lt;dbl&gt;, holiday_No.Holiday_x_seasons_Spring &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Summer &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Winter &lt;dbl&gt;, …\n\nrecipe3 &lt;- recipe(log_bike_rentals ~ ., data = bike_rentals_train) |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(day_type = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"), \"Weekend\", \"Weekday\"))) |&gt;\n  step_rm(date) |&gt;\n  step_rm(starts_with(\"date_dow\")) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_zv(seasons, holiday, day_type) |&gt;\n  step_dummy(seasons, holiday, day_type) |&gt;\n  step_interact(terms = ~starts_with(\"holiday\")*starts_with(\"seasons\") ) |&gt;\n  step_interact(terms = ~mean_temp*starts_with(\"seasons\")) |&gt;\n  step_interact(terms = ~mean_temp*total_rainfall)|&gt;\n  step_poly(total_rainfall, total_snowfall, mean_temp, mean_humidity, mean_wind_speed,\n         mean_visibility, mean_dew_point_temp, mean_solar_radiation, degree = 2)\n\nrecipe3 |&gt;\n  prep(training = bike_rentals_train) |&gt;\n  bake(bike_rentals_train)\n\n# A tibble: 263 × 29\n   log_bike_rentals seasons_Spring seasons_Summer seasons_Winter\n              &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;\n 1            10.2               0              0              0\n 2             9.29              0              0              0\n 3            10.3               0              0              0\n 4            10.3               0              0              0\n 5            10.3               0              0              0\n 6            10.3               0              0              0\n 7            10.3               0              0              0\n 8            10.4               0              0              0\n 9            10.4               0              0              0\n10            10.2               0              0              0\n# ℹ 253 more rows\n# ℹ 25 more variables: holiday_No.Holiday &lt;dbl&gt;, day_type_Weekend &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Spring &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Summer &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Winter &lt;dbl&gt;,\n#   mean_temp_x_seasons_Spring &lt;dbl&gt;, mean_temp_x_seasons_Summer &lt;dbl&gt;,\n#   mean_temp_x_seasons_Winter &lt;dbl&gt;, mean_temp_x_total_rainfall &lt;dbl&gt;, …\n\n\n##Fitting linear model\nSet the linear regression engine to “lm”\n\nMLR_spec &lt;- linear_reg() |&gt;\n  set_engine(\"lm\")\n\ncreating workflows for model\n\nMLR_wkf1 &lt;- workflow()|&gt;\n  add_recipe(recipe1) |&gt;\n  add_model(MLR_spec)\n\nMLR_wkf2 &lt;- workflow()|&gt;\n  add_recipe(recipe2) |&gt;\n  add_model(MLR_spec)\n\nMLR_wkf3 &lt;- workflow()|&gt;\n  add_recipe(recipe3) |&gt;\n  add_model(MLR_spec)\n\nFitting the models with the cross validation folds\n\nMLR_fit1 &lt;- MLR_wkf1 |&gt;\n  fit_resamples(bike_rentals_cv)\n\nMLR_fit2 &lt;- MLR_wkf2 |&gt;\n  fit_resamples(bike_rentals_cv)\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\n\n\nThere were issues with some computations   A: x2\n\n\nThere were issues with some computations   A: x3\n\n\nThere were issues with some computations   A: x4\n\n\nThere were issues with some computations   A: x5\n\n\nThere were issues with some computations   A: x6\n\n\nThere were issues with some computations   A: x7\n\n\nThere were issues with some computations   A: x8\n\n\nThere were issues with some computations   A: x9\n\n\nThere were issues with some computations   A: x10\nThere were issues with some computations   A: x10\n\n\n\n\nMLR_fit3 &lt;- MLR_wkf3 |&gt;\n  fit_resamples(bike_rentals_cv)\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\n\n\nThere were issues with some computations   A: x2\n\n\nThere were issues with some computations   A: x3\n\n\nThere were issues with some computations   A: x4\n\n\nThere were issues with some computations   A: x5\n\n\nThere were issues with some computations   A: x6\n\n\nThere were issues with some computations   A: x7\n\n\nThere were issues with some computations   A: x8\n\n\nThere were issues with some computations   A: x9\n\n\nThere were issues with some computations   A: x10\nThere were issues with some computations   A: x10\n\n\n\n\n\nCollecting metrices from each of the fit\n\nrbind(MLR_fit1 |&gt; collect_metrics() |&gt; filter(.metric == \"rmse\"),\n      MLR_fit2 |&gt; collect_metrics() |&gt; filter(.metric == \"rmse\"),\n      MLR_fit3 |&gt; collect_metrics() |&gt; filter(.metric == \"rmse\")) |&gt; \n  mutate(Model = c(\"Model 1\", \"Model 2\", \"Model 3\")) |&gt;\n  select(Model, mean, n, std_err)\n\n# A tibble: 3 × 4\n  Model    mean     n std_err\n  &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;\n1 Model 1 0.298    10  0.0211\n2 Model 2 0.241    10  0.0143\n3 Model 3 0.246    10  0.0156\n\n\nFrom the above table, we can see that Model 2 has the the least rmse\nFitting the best model (model 2) to entire training set date,\n\nMLR_wkf2 |&gt;\n  last_fit(bike_rentals_split) |&gt;\n  collect_metrics()\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\nThere were issues with some computations   A: x1\n\n\n\n\n\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config        \n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          \n1 rmse    standard       0.185 pre0_mod0_post0\n2 rsq     standard       0.945 pre0_mod0_post0\n\n\nfitting the final model\n\nfinal_model &lt;- MLR_wkf2 |&gt;\n  fit(bike_rentals_train)\ntidy(final_model)\n\n# A tibble: 21 × 5\n   term                 estimate std.error statistic   p.value\n   &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;\n 1 (Intercept)            9.70      0.115      84.7  2.11e-182\n 2 total_rainfall        -0.364     0.0308    -11.8  8.93e- 26\n 3 total_snowfall        -0.0258    0.0152     -1.70 9.09e-  2\n 4 mean_temp             -0.465     0.325      -1.43 1.55e-  1\n 5 mean_humidity         -0.227     0.112      -2.02 4.44e-  2\n 6 mean_wind_speed       -0.0319    0.0163     -1.96 5.13e-  2\n 7 mean_visibility        0.0311    0.0213      1.46 1.46e-  1\n 8 mean_dew_point_temp    0.834     0.365       2.29 2.32e-  2\n 9 mean_solar_radiation   0.191     0.0259      7.38 2.51e- 12\n10 seasons_Spring        -0.209     0.200      -1.05 2.96e-  1\n# ℹ 11 more rows\n\n\nextracting the final model fit in lm form\n\nmy_fit &lt;- extract_fit_parsnip(final_model)\nlm_fit &lt;- my_fit$fit\nsummary(lm_fit)\n\n\nCall:\nstats::lm(formula = ..y ~ ., data = data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.19074 -0.11339  0.00571  0.11023  0.61362 \n\nCoefficients: (1 not defined because of singularities)\n                                    Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)                          9.70084    0.11452  84.708  &lt; 2e-16 ***\ntotal_rainfall                      -0.36446    0.03083 -11.822  &lt; 2e-16 ***\ntotal_snowfall                      -0.02581    0.01521  -1.697   0.0909 .  \nmean_temp                           -0.46475    0.32539  -1.428   0.1545    \nmean_humidity                       -0.22671    0.11219  -2.021   0.0444 *  \nmean_wind_speed                     -0.03189    0.01628  -1.958   0.0513 .  \nmean_visibility                      0.03107    0.02131   1.458   0.1462    \nmean_dew_point_temp                  0.83403    0.36497   2.285   0.0232 *  \nmean_solar_radiation                 0.19129    0.02592   7.379 2.51e-12 ***\nseasons_Spring                      -0.20900    0.19951  -1.048   0.2959    \nseasons_Summer                       0.52440    0.11771   4.455 1.28e-05 ***\nseasons_Winter                      -0.47767    0.17162  -2.783   0.0058 ** \nholiday_No.Holiday                   0.26279    0.11725   2.241   0.0259 *  \nday_type_Weekend                    -0.15612    0.03072  -5.083 7.43e-07 ***\nholiday_No.Holiday_x_seasons_Spring -0.07729    0.20061  -0.385   0.7004    \nholiday_No.Holiday_x_seasons_Summer       NA         NA      NA       NA    \nholiday_No.Holiday_x_seasons_Winter  0.13732    0.15233   0.901   0.3682    \nmean_temp_x_seasons_Spring           0.43123    0.08289   5.203 4.18e-07 ***\nmean_temp_x_seasons_Summer          -0.66160    0.10919  -6.059 5.18e-09 ***\nmean_temp_x_seasons_Winter           0.48973    0.10050   4.873 1.98e-06 ***\nmean_temp_x_total_rainfall           0.22076    0.03449   6.401 7.90e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2213 on 243 degrees of freedom\nMultiple R-squared:  0.9223,    Adjusted R-squared:  0.9162 \nF-statistic: 151.7 on 19 and 243 DF,  p-value: &lt; 2.2e-16"
  },
  {
    "objectID": "HW8.html#section",
    "href": "HW8.html#section",
    "title": "HW8",
    "section": "",
    "text": "library (tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.2\n✔ ggplot2   4.0.0     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.1.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(tidymodels)\n\nWarning: package 'tidymodels' was built under R version 4.5.2\n\n\n── Attaching packages ────────────────────────────────────── tidymodels 1.4.1 ──\n✔ broom        1.0.10     ✔ rsample      1.3.1 \n✔ dials        1.4.2      ✔ tailor       0.1.0 \n✔ infer        1.0.9      ✔ tune         2.0.1 \n✔ modeldata    1.5.1      ✔ workflows    1.3.0 \n✔ parsnip      1.3.3      ✔ workflowsets 1.1.1 \n✔ recipes      1.3.1      ✔ yardstick    1.3.2 \n\n\nWarning: package 'dials' was built under R version 4.5.2\n\n\nWarning: package 'infer' was built under R version 4.5.2\n\n\nWarning: package 'modeldata' was built under R version 4.5.2\n\n\nWarning: package 'parsnip' was built under R version 4.5.2\n\n\nWarning: package 'recipes' was built under R version 4.5.2\n\n\nWarning: package 'rsample' was built under R version 4.5.2\n\n\nWarning: package 'tailor' was built under R version 4.5.2\n\n\nWarning: package 'tune' was built under R version 4.5.2\n\n\nWarning: package 'workflows' was built under R version 4.5.2\n\n\nWarning: package 'workflowsets' was built under R version 4.5.2\n\n\nWarning: package 'yardstick' was built under R version 4.5.2\n\n\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n\nlibrary (ggcharts)\n\nReading CSV file\n\nbike_rentals &lt;- read_csv(\"https://www4.stat.ncsu.edu/~online/datasets/SeoulBikeData.csv\", \n                              locale = locale(encoding = \"latin1\"),\n                         name_repair = function(nm) str_to_lower(str_replace_all(str_replace_all(nm, \" \", \"_\"), \"[()/°%]\", \"\")))\n\nRows: 8760 Columns: 14\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (4): date, seasons, holiday, functioning_day\ndbl (10): rented_bike_count, hour, temperaturec, humidity, wind_speed_ms, vi...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nbike_rentals\n\n# A tibble: 8,760 × 14\n   date       rented_bike_count  hour temperaturec humidity wind_speed_ms\n   &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;\n 1 01/12/2017               254     0         -5.2       37           2.2\n 2 01/12/2017               204     1         -5.5       38           0.8\n 3 01/12/2017               173     2         -6         39           1  \n 4 01/12/2017               107     3         -6.2       40           0.9\n 5 01/12/2017                78     4         -6         36           2.3\n 6 01/12/2017               100     5         -6.4       37           1.5\n 7 01/12/2017               181     6         -6.6       35           1.3\n 8 01/12/2017               460     7         -7.4       38           0.9\n 9 01/12/2017               930     8         -7.6       37           1.1\n10 01/12/2017               490     9         -6.5       27           0.5\n# ℹ 8,750 more rows\n# ℹ 8 more variables: visibility_10m &lt;dbl&gt;, dew_point_temperaturec &lt;dbl&gt;,\n#   solar_radiation_mjm2 &lt;dbl&gt;, rainfallmm &lt;dbl&gt;, snowfall_cm &lt;dbl&gt;,\n#   seasons &lt;chr&gt;, holiday &lt;chr&gt;, functioning_day &lt;chr&gt;\n\n\n\nbike_rentals &lt;- bike_rentals |&gt;\n  rename(\"temp\" = \"temperaturec\",\n         \"wind_speed\" = \"wind_speed_ms\",\n         \"visibility\" = `visibility_10m`,\n         \"dew_point_temp\" = \"dew_point_temperaturec\",\n         \"rainfall\" = \"rainfallmm\",\n         \"solar_radiation\" = \"solar_radiation_mjm2\",\n         \"snowfall\" = \"snowfall_cm\")\n\n\npsych::describe(bike_rentals)\n\n                  vars    n    mean     sd  median trimmed    mad   min     max\ndate*                1 8760  183.00 105.37  183.00  183.00 134.92   1.0  365.00\nrented_bike_count    2 8760  704.60 645.00  504.50  612.58 553.75   0.0 3556.00\nhour                 3 8760   11.50   6.92   11.50   11.50   8.90   0.0   23.00\ntemp                 4 8760   12.88  11.94   13.70   13.19  13.94 -17.8   39.40\nhumidity             5 8760   58.23  20.36   57.00   58.02  23.72   0.0   98.00\nwind_speed           6 8760    1.72   1.04    1.50    1.63   1.04   0.0    7.40\nvisibility           7 8760 1436.83 608.30 1698.00 1509.50 447.75  27.0 2000.00\ndew_point_temp       8 8760    4.07  13.06    5.10    4.76  14.38 -30.6   27.20\nsolar_radiation      9 8760    0.57   0.87    0.01    0.38   0.01   0.0    3.52\nrainfall            10 8760    0.15   1.13    0.00    0.00   0.00   0.0   35.00\nsnowfall            11 8760    0.08   0.44    0.00    0.00   0.00   0.0    8.80\nseasons*            12 8760    2.50   1.11    2.00    2.49   1.48   1.0    4.00\nholiday*            13 8760    1.95   0.22    2.00    2.00   0.00   1.0    2.00\nfunctioning_day*    14 8760    1.97   0.18    2.00    2.00   0.00   1.0    2.00\n                    range  skew kurtosis   se\ndate*              364.00  0.00    -1.20 1.13\nrented_bike_count 3556.00  1.15     0.85 6.89\nhour                23.00  0.00    -1.20 0.07\ntemp                57.20 -0.20    -0.84 0.13\nhumidity            98.00  0.06    -0.80 0.22\nwind_speed           7.40  0.89     0.73 0.01\nvisibility        1973.00 -0.70    -0.96 6.50\ndew_point_temp      57.80 -0.37    -0.76 0.14\nsolar_radiation      3.52  1.50     1.12 0.01\nrainfall            35.00 14.53   284.76 0.01\nsnowfall             8.80  8.44    93.73 0.00\nseasons*             3.00  0.00    -1.35 0.01\nholiday*             1.00 -4.16    15.33 0.00\nfunctioning_day*     1.00 -5.17    24.72 0.00\n\n\nFrom the above psych::describe, there are no missing data in any of the columns\ntotal missing values in each column\n\nsapply (bike_rentals, function (x)sum (is.na(x)))\n\n             date rented_bike_count              hour              temp \n                0                 0                 0                 0 \n         humidity        wind_speed        visibility    dew_point_temp \n                0                 0                 0                 0 \n  solar_radiation          rainfall          snowfall           seasons \n                0                 0                 0                 0 \n          holiday   functioning_day \n                0                 0 \n\n\nChecking unique values for the categorical variables\n\nunique(bike_rentals$seasons)\n\n[1] \"Winter\" \"Spring\" \"Summer\" \"Autumn\"\n\nunique(bike_rentals$holiday)\n\n[1] \"No Holiday\" \"Holiday\"   \n\nunique(bike_rentals$functioning_day)\n\n[1] \"Yes\" \"No\" \n\n\n\nbike_rentals &lt;- bike_rentals |&gt;\n  mutate(date = dmy(date),\n         seasons = as.factor(seasons),\n         holiday = as.factor(holiday),\n         functioning_day = as.factor(functioning_day)\n        )\nbike_rentals\n\n# A tibble: 8,760 × 14\n   date       rented_bike_count  hour  temp humidity wind_speed visibility\n   &lt;date&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 2017-12-01               254     0  -5.2       37        2.2       2000\n 2 2017-12-01               204     1  -5.5       38        0.8       2000\n 3 2017-12-01               173     2  -6         39        1         2000\n 4 2017-12-01               107     3  -6.2       40        0.9       2000\n 5 2017-12-01                78     4  -6         36        2.3       2000\n 6 2017-12-01               100     5  -6.4       37        1.5       2000\n 7 2017-12-01               181     6  -6.6       35        1.3       2000\n 8 2017-12-01               460     7  -7.4       38        0.9       2000\n 9 2017-12-01               930     8  -7.6       37        1.1       2000\n10 2017-12-01               490     9  -6.5       27        0.5       1928\n# ℹ 8,750 more rows\n# ℹ 7 more variables: dew_point_temp &lt;dbl&gt;, solar_radiation &lt;dbl&gt;,\n#   rainfall &lt;dbl&gt;, snowfall &lt;dbl&gt;, seasons &lt;fct&gt;, holiday &lt;fct&gt;,\n#   functioning_day &lt;fct&gt;\n\n\nSubsetting on functioning_day = Yes as summary on the rented bike count is all 0\n\nbike_rentals |&gt;\n  filter(functioning_day == \"No\") |&gt;\n  group_by(date, seasons, holiday, functioning_day) |&gt;\n  summarize(across(rented_bike_count, \n                   list(\"mean\" = mean, \"median\" = median, \"sd\" = sd ),\n                   .names = \"{.fn}_{.col}\"))\n\n`summarise()` has grouped output by 'date', 'seasons', 'holiday'. You can\noverride using the `.groups` argument.\n\n\n# A tibble: 13 × 7\n# Groups:   date, seasons, holiday [13]\n   date       seasons holiday    functioning_day mean_rented_bike_count\n   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;      &lt;fct&gt;                            &lt;dbl&gt;\n 1 2018-04-11 Spring  No Holiday No                                   0\n 2 2018-05-10 Spring  No Holiday No                                   0\n 3 2018-09-18 Autumn  No Holiday No                                   0\n 4 2018-09-19 Autumn  No Holiday No                                   0\n 5 2018-09-28 Autumn  No Holiday No                                   0\n 6 2018-09-30 Autumn  No Holiday No                                   0\n 7 2018-10-02 Autumn  No Holiday No                                   0\n 8 2018-10-04 Autumn  No Holiday No                                   0\n 9 2018-10-06 Autumn  No Holiday No                                   0\n10 2018-10-09 Autumn  Holiday    No                                   0\n11 2018-11-03 Autumn  No Holiday No                                   0\n12 2018-11-06 Autumn  No Holiday No                                   0\n13 2018-11-09 Autumn  No Holiday No                                   0\n# ℹ 2 more variables: median_rented_bike_count &lt;dbl&gt;,\n#   sd_rented_bike_count &lt;dbl&gt;\n\n\nCalculating sum across rented_bike_count, rainfall and snowfall variables and mean across the weather variables for final model data sets\n\nbike_model_data &lt;- bike_rentals |&gt;\n  filter(functioning_day == \"Yes\") |&gt;\n  group_by(date, seasons, holiday) |&gt;\n  summarize(across(c(rented_bike_count, rainfall, snowfall, temp, humidity, wind_speed, visibility,\n                     dew_point_temp, solar_radiation),\n                   .fns = list(\"total\" = sum, \"mean\" = mean),\n                   .names = \"{.fn}_{.col}\")) |&gt;\n  select(date, seasons, holiday, total_rented_bike_count, total_rainfall, total_snowfall, mean_temp, mean_humidity, mean_wind_speed,\n         mean_visibility, mean_dew_point_temp, mean_solar_radiation)\n\n`summarise()` has grouped output by 'date', 'seasons'. You can override using\nthe `.groups` argument.\n\nbike_model_data\n\n# A tibble: 353 × 12\n# Groups:   date, seasons [353]\n   date       seasons holiday    total_rented_bike_count total_rainfall\n   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                        &lt;dbl&gt;          &lt;dbl&gt;\n 1 2017-12-01 Winter  No Holiday                    9539            0  \n 2 2017-12-02 Winter  No Holiday                    8523            0  \n 3 2017-12-03 Winter  No Holiday                    7222            4  \n 4 2017-12-04 Winter  No Holiday                    8729            0.1\n 5 2017-12-05 Winter  No Holiday                    8307            0  \n 6 2017-12-06 Winter  No Holiday                    6669            1.3\n 7 2017-12-07 Winter  No Holiday                    8549            0  \n 8 2017-12-08 Winter  No Holiday                    8032            0  \n 9 2017-12-09 Winter  No Holiday                    7233            0  \n10 2017-12-10 Winter  No Holiday                    3453            4.1\n# ℹ 343 more rows\n# ℹ 7 more variables: total_snowfall &lt;dbl&gt;, mean_temp &lt;dbl&gt;,\n#   mean_humidity &lt;dbl&gt;, mean_wind_speed &lt;dbl&gt;, mean_visibility &lt;dbl&gt;,\n#   mean_dew_point_temp &lt;dbl&gt;, mean_solar_radiation &lt;dbl&gt;\n\n\n##Summary plots\nCreating box plots for total bike rental with categorical variables\n\nggplot(data = bike_model_data,\n      aes(x = seasons, y = total_rented_bike_count, fill = seasons)) + \n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.4)\n\n\n\n\n\n\n\n\nFrom the above box plot , we can say that season direct influence on the bike rental count with winter being the slow season and summer being the high season.\n\nggplot(data = bike_model_data,\n      aes(x = holiday, y = total_rented_bike_count, fill = holiday)) + \n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.4)\n\n\n\n\n\n\n\n\nThe above box plot shows that there are less outliers for bike rented during non holidays than holidays.\nCreating scatter plots for numerical variables\n\nggplot(data = bike_model_data,\n      aes(x = total_rainfall, y = total_rented_bike_count, color = holiday)) +\n  geom_point() + geom_smooth(method = lm)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nThe above scatter plot shows that there is high correlation between rainfall amount and bike rented count. Also the rental count is affected by holiday as well.\n\nggplot(data = bike_model_data,\n      aes(x = total_rainfall, y = total_rented_bike_count, color = seasons)) +\n  geom_point() + geom_smooth(method = lm)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nFrom the above line graph, apart of from rainfall, there is some correlation between the bike rental count and seasons as well.\n\nggplot(data = bike_model_data,\n      aes(x = mean_temp, y = total_rented_bike_count, color = holiday)) +\n  geom_point() + geom_smooth(method = lm)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nFrom the above graph, when the temp increases the bike rental count also increases, with temperature in the range 2o to 25 being more favorable. Also from the line fit on holiday shows that holiday has some effect in the total bike rent count.\n\nggplot(data = bike_model_data,\n      aes(x = mean_temp, y = total_rented_bike_count, color = seasons)) +\n  geom_point() + geom_smooth(method = lm)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nFrom the above graph, when the temp increases the bike rental count also increases, with temperature in the range 2o to 25 being more favorable. Apart from temperature, the season also affect the total bike rental count. As shown in graph in summer bike rental count increases than in winter.\n##Data modeling\nCreating the model data with training and testing set\n\nbike_model_log &lt;- bike_model_data |&gt;\n  mutate(log_bike_rentals = log(total_rented_bike_count)) |&gt;\n  select(-total_rented_bike_count)\n\nbike_rentals_split &lt;- initial_split(bike_model_log, prop = 0.75, strata = seasons)\nbike_rentals_train &lt;- training(bike_rentals_split)\nbike_rentals_test &lt;- testing(bike_rentals_split)\n\n10 fold CV of the training data\n\nbike_rentals_cv &lt;- vfold_cv(bike_rentals_train, 10)\n\nCreating different recipes\n\nrecipe1 &lt;- recipe(log_bike_rentals ~ ., data = bike_rentals_train) |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(day_type = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"), \"Weekend\", \"Weekday\"))) |&gt;\n  step_rm(date) |&gt;\n  step_rm(starts_with(\"date_dow\")) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, day_type) \n\nrecipe1 |&gt;\n  prep(training = bike_rentals_train) |&gt;\n  bake(bike_rentals_train)\n\n# A tibble: 263 × 14\n   total_rainfall total_snowfall mean_temp mean_humidity mean_wind_speed\n            &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;\n 1         -0.299         -0.211     1.08         0.203          -0.866 \n 2          2.86          -0.211     0.918        1.65           -1.12  \n 3         -0.299         -0.211     0.938        0.243           1.35  \n 4         -0.162         -0.211     0.795       -0.0939          1.31  \n 5         -0.299         -0.211     0.755       -0.656          -0.0810\n 6         -0.299         -0.211     0.778       -0.602          -0.823 \n 7         -0.299         -0.211     0.862       -0.559          -0.259 \n 8         -0.299         -0.211     0.744       -0.705          -0.409 \n 9         -0.299         -0.211     0.826       -0.434          -0.673 \n10         -0.253         -0.211     0.906        0.614          -0.702 \n# ℹ 253 more rows\n# ℹ 9 more variables: mean_visibility &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,\n#   mean_solar_radiation &lt;dbl&gt;, log_bike_rentals &lt;dbl&gt;, seasons_Spring &lt;dbl&gt;,\n#   seasons_Summer &lt;dbl&gt;, seasons_Winter &lt;dbl&gt;, holiday_No.Holiday &lt;dbl&gt;,\n#   day_type_Weekend &lt;dbl&gt;\n\nrecipe2 &lt;- recipe(log_bike_rentals ~ ., data = bike_rentals_train) |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(day_type = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"), \"Weekend\", \"Weekday\"))) |&gt;\n  step_rm(date) |&gt;\n  step_rm(starts_with(\"date_dow\")) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, day_type) |&gt;\n  step_interact(terms = ~starts_with(\"holiday\")*starts_with(\"seasons\") ) |&gt;\n  step_interact(terms = ~mean_temp*starts_with(\"seasons\")) |&gt;\n  step_interact(terms = ~mean_temp*total_rainfall)\n\nrecipe2 |&gt;\n  prep(training = bike_rentals_train) |&gt;\n  bake(bike_rentals_train)\n\n# A tibble: 263 × 21\n   total_rainfall total_snowfall mean_temp mean_humidity mean_wind_speed\n            &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;\n 1         -0.299         -0.211     1.08         0.203          -0.866 \n 2          2.86          -0.211     0.918        1.65           -1.12  \n 3         -0.299         -0.211     0.938        0.243           1.35  \n 4         -0.162         -0.211     0.795       -0.0939          1.31  \n 5         -0.299         -0.211     0.755       -0.656          -0.0810\n 6         -0.299         -0.211     0.778       -0.602          -0.823 \n 7         -0.299         -0.211     0.862       -0.559          -0.259 \n 8         -0.299         -0.211     0.744       -0.705          -0.409 \n 9         -0.299         -0.211     0.826       -0.434          -0.673 \n10         -0.253         -0.211     0.906        0.614          -0.702 \n# ℹ 253 more rows\n# ℹ 16 more variables: mean_visibility &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,\n#   mean_solar_radiation &lt;dbl&gt;, log_bike_rentals &lt;dbl&gt;, seasons_Spring &lt;dbl&gt;,\n#   seasons_Summer &lt;dbl&gt;, seasons_Winter &lt;dbl&gt;, holiday_No.Holiday &lt;dbl&gt;,\n#   day_type_Weekend &lt;dbl&gt;, holiday_No.Holiday_x_seasons_Spring &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Summer &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Winter &lt;dbl&gt;, …\n\nrecipe3 &lt;- recipe(log_bike_rentals ~ ., data = bike_rentals_train) |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(day_type = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"), \"Weekend\", \"Weekday\"))) |&gt;\n  step_rm(date) |&gt;\n  step_rm(starts_with(\"date_dow\")) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_zv(seasons, holiday, day_type) |&gt;\n  step_dummy(seasons, holiday, day_type) |&gt;\n  step_interact(terms = ~starts_with(\"holiday\")*starts_with(\"seasons\") ) |&gt;\n  step_interact(terms = ~mean_temp*starts_with(\"seasons\")) |&gt;\n  step_interact(terms = ~mean_temp*total_rainfall)|&gt;\n  step_poly(total_rainfall, total_snowfall, mean_temp, mean_humidity, mean_wind_speed,\n         mean_visibility, mean_dew_point_temp, mean_solar_radiation, degree = 2)\n\nrecipe3 |&gt;\n  prep(training = bike_rentals_train) |&gt;\n  bake(bike_rentals_train)\n\n# A tibble: 263 × 29\n   log_bike_rentals seasons_Spring seasons_Summer seasons_Winter\n              &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;\n 1            10.2               0              0              0\n 2             9.29              0              0              0\n 3            10.3               0              0              0\n 4            10.3               0              0              0\n 5            10.3               0              0              0\n 6            10.3               0              0              0\n 7            10.3               0              0              0\n 8            10.4               0              0              0\n 9            10.4               0              0              0\n10            10.2               0              0              0\n# ℹ 253 more rows\n# ℹ 25 more variables: holiday_No.Holiday &lt;dbl&gt;, day_type_Weekend &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Spring &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Summer &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Winter &lt;dbl&gt;,\n#   mean_temp_x_seasons_Spring &lt;dbl&gt;, mean_temp_x_seasons_Summer &lt;dbl&gt;,\n#   mean_temp_x_seasons_Winter &lt;dbl&gt;, mean_temp_x_total_rainfall &lt;dbl&gt;, …\n\n\n##Fitting linear model\nSet the linear regression engine to “lm”\n\nMLR_spec &lt;- linear_reg() |&gt;\n  set_engine(\"lm\")\n\ncreating workflows for model\n\nMLR_wkf1 &lt;- workflow()|&gt;\n  add_recipe(recipe1) |&gt;\n  add_model(MLR_spec)\n\nMLR_wkf2 &lt;- workflow()|&gt;\n  add_recipe(recipe2) |&gt;\n  add_model(MLR_spec)\n\nMLR_wkf3 &lt;- workflow()|&gt;\n  add_recipe(recipe3) |&gt;\n  add_model(MLR_spec)\n\nFitting the models with the cross validation folds\n\nMLR_fit1 &lt;- MLR_wkf1 |&gt;\n  fit_resamples(bike_rentals_cv)\n\nMLR_fit2 &lt;- MLR_wkf2 |&gt;\n  fit_resamples(bike_rentals_cv)\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\n\n\nThere were issues with some computations   A: x2\n\n\nThere were issues with some computations   A: x3\n\n\nThere were issues with some computations   A: x4\n\n\nThere were issues with some computations   A: x5\n\n\nThere were issues with some computations   A: x6\n\n\nThere were issues with some computations   A: x7\n\n\nThere were issues with some computations   A: x8\n\n\nThere were issues with some computations   A: x9\n\n\nThere were issues with some computations   A: x10\nThere were issues with some computations   A: x10\n\n\n\n\nMLR_fit3 &lt;- MLR_wkf3 |&gt;\n  fit_resamples(bike_rentals_cv)\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\n\n\nThere were issues with some computations   A: x2\n\n\nThere were issues with some computations   A: x3\n\n\nThere were issues with some computations   A: x4\n\n\nThere were issues with some computations   A: x5\n\n\nThere were issues with some computations   A: x6\n\n\nThere were issues with some computations   A: x7\n\n\nThere were issues with some computations   A: x8\n\n\nThere were issues with some computations   A: x9\n\n\nThere were issues with some computations   A: x10\nThere were issues with some computations   A: x10\n\n\n\n\n\nCollecting metrices from each of the fit\n\nrbind(MLR_fit1 |&gt; collect_metrics() |&gt; filter(.metric == \"rmse\"),\n      MLR_fit2 |&gt; collect_metrics() |&gt; filter(.metric == \"rmse\"),\n      MLR_fit3 |&gt; collect_metrics() |&gt; filter(.metric == \"rmse\")) |&gt; \n  mutate(Model = c(\"Model 1\", \"Model 2\", \"Model 3\")) |&gt;\n  select(Model, mean, n, std_err)\n\n# A tibble: 3 × 4\n  Model    mean     n std_err\n  &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;\n1 Model 1 0.298    10  0.0211\n2 Model 2 0.241    10  0.0143\n3 Model 3 0.246    10  0.0156\n\n\nFrom the above table, we can see that Model 2 has the the least rmse\nFitting the best model (model 2) to entire training set date,\n\nMLR_wkf2 |&gt;\n  last_fit(bike_rentals_split) |&gt;\n  collect_metrics()\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\nThere were issues with some computations   A: x1\n\n\n\n\n\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config        \n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          \n1 rmse    standard       0.185 pre0_mod0_post0\n2 rsq     standard       0.945 pre0_mod0_post0\n\n\nfitting the final model\n\nfinal_model &lt;- MLR_wkf2 |&gt;\n  fit(bike_rentals_train)\ntidy(final_model)\n\n# A tibble: 21 × 5\n   term                 estimate std.error statistic   p.value\n   &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;\n 1 (Intercept)            9.70      0.115      84.7  2.11e-182\n 2 total_rainfall        -0.364     0.0308    -11.8  8.93e- 26\n 3 total_snowfall        -0.0258    0.0152     -1.70 9.09e-  2\n 4 mean_temp             -0.465     0.325      -1.43 1.55e-  1\n 5 mean_humidity         -0.227     0.112      -2.02 4.44e-  2\n 6 mean_wind_speed       -0.0319    0.0163     -1.96 5.13e-  2\n 7 mean_visibility        0.0311    0.0213      1.46 1.46e-  1\n 8 mean_dew_point_temp    0.834     0.365       2.29 2.32e-  2\n 9 mean_solar_radiation   0.191     0.0259      7.38 2.51e- 12\n10 seasons_Spring        -0.209     0.200      -1.05 2.96e-  1\n# ℹ 11 more rows\n\n\nextracting the final model fit in lm form\n\nmy_fit &lt;- extract_fit_parsnip(final_model)\nlm_fit &lt;- my_fit$fit\nsummary(lm_fit)\n\n\nCall:\nstats::lm(formula = ..y ~ ., data = data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.19074 -0.11339  0.00571  0.11023  0.61362 \n\nCoefficients: (1 not defined because of singularities)\n                                    Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)                          9.70084    0.11452  84.708  &lt; 2e-16 ***\ntotal_rainfall                      -0.36446    0.03083 -11.822  &lt; 2e-16 ***\ntotal_snowfall                      -0.02581    0.01521  -1.697   0.0909 .  \nmean_temp                           -0.46475    0.32539  -1.428   0.1545    \nmean_humidity                       -0.22671    0.11219  -2.021   0.0444 *  \nmean_wind_speed                     -0.03189    0.01628  -1.958   0.0513 .  \nmean_visibility                      0.03107    0.02131   1.458   0.1462    \nmean_dew_point_temp                  0.83403    0.36497   2.285   0.0232 *  \nmean_solar_radiation                 0.19129    0.02592   7.379 2.51e-12 ***\nseasons_Spring                      -0.20900    0.19951  -1.048   0.2959    \nseasons_Summer                       0.52440    0.11771   4.455 1.28e-05 ***\nseasons_Winter                      -0.47767    0.17162  -2.783   0.0058 ** \nholiday_No.Holiday                   0.26279    0.11725   2.241   0.0259 *  \nday_type_Weekend                    -0.15612    0.03072  -5.083 7.43e-07 ***\nholiday_No.Holiday_x_seasons_Spring -0.07729    0.20061  -0.385   0.7004    \nholiday_No.Holiday_x_seasons_Summer       NA         NA      NA       NA    \nholiday_No.Holiday_x_seasons_Winter  0.13732    0.15233   0.901   0.3682    \nmean_temp_x_seasons_Spring           0.43123    0.08289   5.203 4.18e-07 ***\nmean_temp_x_seasons_Summer          -0.66160    0.10919  -6.059 5.18e-09 ***\nmean_temp_x_seasons_Winter           0.48973    0.10050   4.873 1.98e-06 ***\nmean_temp_x_total_rainfall           0.22076    0.03449   6.401 7.90e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2213 on 243 degrees of freedom\nMultiple R-squared:  0.9223,    Adjusted R-squared:  0.9162 \nF-statistic: 151.7 on 19 and 243 DF,  p-value: &lt; 2.2e-16"
  }
]